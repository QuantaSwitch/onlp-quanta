/**************************************************************************//**
 *
 *
 *
 *****************************************************************************/
#include <quanta_sys_eeprom/quanta_sys_eeprom_config.h>
#include <quanta_sys_eeprom/eeprom.h>

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <AIM/aim.h>


struct eeprom_data_s {
    uint8_t eeprom[256];
    quanta_sys_eeprom_t data;
} test_data__[] =
    {
        {
            {
                0xff, 0x01, 0xe0, 0x01, 0x03, 0x4c, 0x59, 0x32, 0x02, 0x0b, 0x31,
                0x4c, 0x59, 0x32, 0x42, 0x5a, 0x5a, 0x30, 0x30, 0x30, 0x52, 0x03,
                0x0d, 0x51, 0x54, 0x46, 0x43, 0x45, 0x41, 0x33, 0x32, 0x31, 0x30,
                0x30, 0x32, 0x31, 0x04, 0x06, 0x08, 0x9e, 0x01, 0xce, 0xde, 0x75,
                0x05, 0x04, 0x07, 0xdd, 0x05, 0x0a, 0x06, 0x04, 0x00, 0x00, 0x00,
                0x01, 0x07, 0x04, 0x00, 0x03, 0x00, 0x00, 0x08, 0x01, 0x31, 0x09,
                0x0a, 0x51, 0x55, 0x41, 0x4e, 0x54, 0x41, 0x20, 0x4c, 0x59, 0x32,
                0x0a, 0x04, 0x00, 0x00, 0xf2, 0x01, 0x00, 0x02, 0xfb, 0x67, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            },
            {
                "LY2",
                "QUANTA LY2",
                "1LY2BZZ000R",
                "QTFCEA3210021",
                "05/10/2013 08:00:00",
                "1",
                {0x08, 0x9e, 0x01, 0xce, 0xde, 0x75},
                0x30000,
                0xf201,
                0x1,
                0xfb67,
            },
        },
        {
            {
                0xff, 0x01, 0xe0, 0x01, 0x03, 0x4c, 0x59, 0x32, 0x02, 0x0b,
                0x31, 0x4c, 0x59, 0x32, 0x42, 0x5a, 0x5a, 0x30, 0x30, 0x30,
                0x38, 0x03, 0x0d, 0x51, 0x54, 0x46, 0x43, 0x45, 0x41, 0x32,
                0x34, 0x32, 0x30, 0x30, 0x32, 0x32, 0x04, 0x06, 0x08, 0x9e,
                0x01, 0x53, 0x78, 0xa6, 0x05, 0x04, 0x07, 0xdc, 0x0a, 0x0f,
                0x06, 0x04, 0x00, 0x00, 0x00, 0x01, 0x07, 0x04, 0x00, 0x03,
                0x00, 0x00, 0x08, 0x01, 0x31, 0x09, 0x0a, 0x51, 0x55, 0x41,
                0x4e, 0x54, 0x41, 0x20, 0x4c, 0x59, 0x32, 0x0a, 0x04, 0x00,
                0x00, 0xf2, 0x01, 0x00, 0x02, 0xc0, 0x74, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            },
            {
                "LY2",
                "QUANTA LY2",
                "1LY2BZZ0008",
                "QTFCEA2420022",
                "10/15/2012 08:00:00",
                "1",
                {0x08, 0x9e, 0x01, 0x53, 0x78, 0xa6},
                0x30000,
                0xf201,
                0x1,
                0xc074,
            },
        },
        {
            {
                0xff, 0x01, 0xe0, 0x01, 0x03, 0x4c, 0x42, 0x39, 0x02, 0x0b,
                0x31, 0x4c, 0x42, 0x39, 0x42, 0x5a, 0x5a, 0x30, 0x53, 0x54,
                0x51, 0x03, 0x0d, 0x51, 0x54, 0x46, 0x43, 0x41, 0x36, 0x33,
                0x32, 0x38, 0x30, 0x30, 0x30, 0x31, 0x04, 0x06, 0x08, 0x9e,
                0x01, 0xce, 0xbd, 0x2d, 0x05, 0x04, 0x07, 0xdd, 0x07, 0x05,
                0x06, 0x04, 0x00, 0x00, 0x00, 0x01, 0x07, 0x04, 0x01, 0x00,
                0x00, 0x00, 0x08, 0x01, 0x31, 0x09, 0x0a, 0x51, 0x55, 0x41,
                0x4e, 0x54, 0x41, 0x20, 0x4c, 0x42, 0x39, 0x0a, 0x04, 0x00,
                0x00, 0xb9, 0x01, 0x00, 0x02, 0x56, 0xc0, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            },
            {
                "LB9",
                "QUANTA LB9",
                "1LB9BZZ0STQ",
                "QTFCA63280001",
                "07/05/2013 08:00:00",
                "1",
                {0x08,0x9e,0x01,0xce,0xbd,0x2d},
                0x1000000,
                0xb901,
                0x1,
                0x56c0,
            },
        },
        {
            {
                0xff, 0x01, 0xe0, 0x01, 0x03, 0x4c, 0x42, 0x39, 0x02, 0x0b,
                0x31, 0x4c, 0x42, 0x39, 0x42, 0x5a, 0x5a, 0x30, 0x53, 0x54,
                0x45, 0x03, 0x0d, 0x51, 0x54, 0x46, 0x43, 0x58, 0x49, 0x32,
                0x34, 0x36, 0x30, 0x32, 0x30, 0x33, 0x04, 0x06, 0x04, 0x7d,
                0x7b, 0xfc, 0xa7, 0x43, 0x05, 0x04, 0x07, 0xdc, 0x08, 0x05,
                0x06, 0x04, 0x00, 0x00, 0x00, 0x01, 0x07, 0x04, 0x01, 0x00,
                0x00, 0x00, 0x08, 0x01, 0x31, 0x09, 0x0a, 0x51, 0x55, 0x41,
                0x4e, 0x54, 0x41, 0x20, 0x4c, 0x42, 0x39, 0x0a, 0x04, 0x00,
                0x00, 0xb9, 0x01, 0x00, 0x02, 0x41, 0x53, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            },
            {
                "LB9",
                "QUANTA LB9",
                "1LB9BZZ0STE",
                "QTFCXI2460203",
                "08/05/2012 08:00:00",
                "1",
                {0x04,0x7d,0x7b,0x0fc,0xa7,0x43},
                0x1000000,
                0xb901,
                0x1,
                0x4153,
            },
        },
    };


int aim_main(int argc, char* argv[])
{
    int i;
    quanta_sys_eeprom_t e;


    for(i = 0; i < AIM_ARRAYSIZE(test_data__); i++) {
        if(quanta_sys_eeprom_parse_data(test_data__[i].eeprom,
                                        sizeof(test_data__[i].eeprom),
                                        &e) < 0) {
            AIM_DIE("parse entry %d failed.");
        }
        if(memcmp(&e, &test_data__[i].data, sizeof(e))) {
            printf("Mismatch entry %d\n", i);
            printf("Expected: \n");
            quanta_sys_eeprom_show(&aim_pvs_stdout, &test_data__[i].data);
            printf("\nGot: \n");
            quanta_sys_eeprom_show(&aim_pvs_stdout, &e);
            AIM_DIE("Entry %d failed", i);
        }
    }
    return 0;
}

